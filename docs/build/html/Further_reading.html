

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Further Reading &mdash; qmflows 0.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Library Documentation" href="documentation.html" />
    <link rel="prev" title="Basic usage tutorial" href="interactive_tutorial.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> qmflows
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="interactive_tutorial.html">Basic usage tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Further Reading</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Generic-Keywords">Generic Keywords</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Templates">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Molecule">Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Runinng-a-quantum-mechanics-simulation">Runinng a quantum mechanics simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Extracting-Properties">Extracting Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Communicating-different-packages">Communicating different packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Running-in-a-supercomputer">Running in a supercomputer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#How-the-run-function-works?">How the run function works?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#A-little-discussion-about-graphs">A little discussion about graphs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Restarting-a-simulation">Restarting a simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Advanced-Examples">Advanced Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Conditional-Workflows">Conditional Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Non-adiabatic-couplings">Non-adiabatic couplings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Exception-Handling">Exception Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Library Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="qd_manual.html">Quantum Dot Builder Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">qmflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Further Reading</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Further_reading.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Further-Reading">
<h1>Further Reading<a class="headerlink" href="#Further-Reading" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Generic-Keywords">
<h2>Generic Keywords<a class="headerlink" href="#Generic-Keywords" title="Permalink to this headline">¶</a></h2>
<p>Quantum chemistry packages use gaussian type orbitals (GTO) or slater type orbitals (STO) to perform the simulation. The packages use the same standards for the basis set and it will be really handy if we can defined a “generic” keyword for basis sets. Fortunately <code class="docutils literal notranslate"><span class="pre">qmflows</span></code> already offers such keyword that can be used among the packages that use the same basis standard,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>Internally <strong>QMflows</strong> will create a hierarchical structure representing basis <em>DZP</em> for the packages that can handle that basis set. Other generic keyowrds like: <code class="docutils literal notranslate"><span class="pre">functional</span></code>, <code class="docutils literal notranslate"><span class="pre">inithess</span></code>, etc. have been implemented.</p>
<p>The Following table describes some of the available generic keywords and the Packages where the funcionality is implemented</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="41%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Generic Keyword</th>
<th class="head">Packages</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>basis</td>
<td>ADF, CP2K, Orca</td>
<td>Set the Basis set</td>
</tr>
<tr class="row-odd"><td>cell_angles</td>
<td>CP2K</td>
<td>Specified the angles of the unit cell</td>
</tr>
<tr class="row-even"><td>cell_parameters</td>
<td>CP2K</td>
<td>Specified the vectors of the unit cell</td>
</tr>
<tr class="row-odd"><td>constraint</td>
<td>ADF, Orca</td>
<td>Constrain the distance, angle or dihedral angle for a set of molecules</td>
</tr>
<tr class="row-even"><td>freeze</td>
<td>ADF, Gamess, Orca</td>
<td>Freeze a set of atoms indicated by their indexes or symbols</td>
</tr>
<tr class="row-odd"><td>functional</td>
<td>ADF, CP2K</td>
<td>Set the DFT functional</td>
</tr>
<tr class="row-even"><td>inithess</td>
<td>ADF, Orca</td>
<td>Provide an initial Hessian matrix</td>
</tr>
<tr class="row-odd"><td>optimize</td>
<td>ADF, DFTB, Orca</td>
<td>Perform a molecular optimization</td>
</tr>
<tr class="row-even"><td>selected_atoms</td>
<td>ADF, Gamess, Orca</td>
<td>Optimize the given set of atoms while keeping the rest fixed</td>
</tr>
<tr class="row-odd"><td>ts</td>
<td>ADF, DFTB, Orca</td>
<td>Carry out a transition state optimization</td>
</tr>
</tbody>
</table>
<p>Note: <strong>QMflows</strong> Does not have chemical intuition and if you provide a meaningless keyword, like a wrong basis set it will not warm you.</p>
</div>
<div class="section" id="Templates">
<h2>Templates<a class="headerlink" href="#Templates" title="Permalink to this headline">¶</a></h2>
<p>As has been shown so far, <strong>Settings</strong> can be specified in two ways: generic or specific. Generic keywords represent input properties that are present in most simulation packages like a <em>basis set</em> while <em>specific</em> keywords resemble the input structure of a given package.</p>
<p><em>Generic</em> and <em>Specific</em> <strong>Settings</strong> can express both simple and complex simulation inputs, but it would be nice if we can pre-defined a set of templates for the most common quantum chemistry simulations like: single point calculations, geometry optimizations, transition state optimization, frequency calculations, etc. <em>qmflows</em> already has a pre-defined set of templates containing some defaults that the user can modify for her/his own purpose. <code class="docutils literal notranslate"><span class="pre">Templates</span></code> are stored inside the
<code class="docutils literal notranslate"><span class="pre">qmflows.templates</span></code> module and are load from <em>JSON</em> files. A JSON file is basically a nested dictionary that is translated to a <code class="docutils literal notranslate"><span class="pre">Settings</span></code> object by <em>qmflows</em>.</p>
<p>Below it is shown the defaults for single point calculation</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>The question is then, <em>how I can modify a template with my own changes?</em></p>
<p>Suppose you are perfoming a bunch of constrained <em>DFT</em> optimizations using <code class="docutils literal notranslate"><span class="pre">ADF</span></code> . You need first to define a basis set and the constrains.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>We use two <em>generic</em> keywords: <code class="docutils literal notranslate"><span class="pre">freeze</span></code> to indicate a constrain and <code class="docutils literal notranslate"><span class="pre">basis</span></code> to provide the basis set. Also, we introduce an specific <code class="docutils literal notranslate"><span class="pre">ADF</span></code> keywords <code class="docutils literal notranslate"><span class="pre">core</span> <span class="pre">=</span> <span class="pre">Large</span></code>. Now you merge your <strong>Settings</strong> with the correspoding template to carry out molecular geometry optimizations, using a method called <code class="docutils literal notranslate"><span class="pre">overlay</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">overlay</span></code> method takes as input a template containing a default set for different packages and also takes the arguments provided by the user, as shown schematically</p>
<p>This <code class="docutils literal notranslate"><span class="pre">overlay</span></code> method merged the defaults for a given packages (<em>ADF</em> in this case) with the input supplied by the user, always given preference to the user input</p>
<p>Below it is shown a combination of templates, generic and specific keywords to generate the input for a <code class="docutils literal notranslate"><span class="pre">CP2K</span></code> job</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
_ipython_canary_method_should_not_exist_:
basis:  DZVP-MOLOPT-SR-GTH
cell_angles:    [90.0, 90.0, 90.0]
cell_parameters:        38.0
potential:      GTH-PBE
specific:
         adf:
             basis:
                   type:        SZ
             integration:
                         accint:        4.0
             scf:
                 converge:      1e-06
                 iterations:    100
             xc:
                __block_replace:        True
                lda:
         cp2k:
              force_eval:
                         dft:
                             basis_set_file_name:
                             mgrid:
                                   cutoff:      400
                                   ngrids:      4
                             potential_file_name:
                             print:
                                   mo:
                                      add_last:         numeric
                                      each:
                                           qs_scf:      0
                                      eigenvalues:
                                      eigenvectors:
                                      filename:         ./mo.data
                                      ndigits:  36
                                      occupation_numbers:
                             qs:
                                method:         gpw
                             scf:
                                 added_mos:
                                 eps_scf:       1e-06
                                 max_scf:       100
                                 scf_guess:     restart
                             xc:
                                xc_functional:  pbe
                         subsys:
                                cell:
                                     periodic:  None
              global:
                     print_level:       low
                     project:   qmflows-cp2k
                     run_type:  energy_force
         dftb:
              dftb:
                   resourcesdir:        DFTB.org/3ob-3-1
              task:
                   runtype:     SP
         dirac:
               DIRAC:   WAVEFUNCTION
               HAMILTONIAN:     LEVY-LEBLOND
               WAVE FUNCTION:   SCF
         gamess:
                basis:
                      gbasis:   sto
                      ngauss:   3
                contrl:
                       dfttyp:  pbe
                       scftyp:  rhf
         orca:
              basis:
                    basis:      sto_sz
              method:
                     functional:        lda
                     method:    dft

</pre></div></div>
</div>
</div>
<div class="section" id="Molecule">
<h2>Molecule<a class="headerlink" href="#Molecule" title="Permalink to this headline">¶</a></h2>
<p>The next component to carry out a simulation is a molecular geometry. <em>qmflows</em> offers a convinient way to read Molecular geometries using the <a class="reference external" href="https://www.scm.com/doc/plams/molecule.html">Plams</a> library in several formats like: <em>xyz</em> , <em>pdb</em>, <em>mol</em>, etc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Atoms:
    1         C      2.419290      0.606560      0.000000
    2         C      1.671470      1.829570      0.000000
    3         N      1.065290      2.809960      0.000000
    4         H      2.000000      0.000000      1.000000
    5         H      2.000000      0.000000     -1.000000
    6         H      3.600000      0.800000      0.000000

</pre></div></div>
</div>
<p>You can also create the molecule one atom at a time</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello world
</pre></div></div>
</div>
<p><strong>QMflows</strong> Can also handle smiles as shown below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Atoms:
    1         C      2.798599     -0.150460      0.089927
    2         C      1.615862     -0.067227     -0.832063
    3         C      0.376333      0.019368      0.053118
    4         C     -0.347606      1.253513     -0.326955
    5         C     -1.822801      1.252517     -0.204840
    6         C     -2.446980     -0.058315      0.156076
    7         C     -1.752081     -1.139264     -0.623091
    8         C     -0.361478     -1.268307     -0.080395
    9         C      0.939434      0.095296      1.441284
   10         C      2.254053      0.292268      1.391042
   11         H      3.270712     -1.144983      0.118276
   12         H      3.579260      0.571882     -0.225622
   13         H      1.583048     -0.956205     -1.489932
   14         H      1.723819      0.828427     -1.481830
   15         H     -0.086390      1.553756     -1.374861
   16         H      0.059603      2.087392      0.301854
   17         H     -2.168065      1.989676      0.564557
   18         H     -2.314662      1.598505     -1.150678
   19         H     -3.508879     -0.050718     -0.200863
   20         H     -2.505664     -0.256055      1.238793
   21         H     -2.273284     -2.097029     -0.440451
   22         H     -1.722856     -0.837576     -1.680683
   23         H      0.171167     -1.989673     -0.753019
   24         H     -0.417079     -1.810866      0.897936
   25         H      0.453939     -0.226576      2.367445
   26         H      2.901995      0.510654      2.244971
  Bonds:
   (1)--1.0--(2)
   (2)--1.0--(3)
   (3)--1.0--(4)
   (4)--1.0--(5)
   (5)--1.0--(6)
   (6)--1.0--(7)
   (7)--1.0--(8)
   (3)--1.0--(9)
   (9)--2.0--(10)
   (10)--1.0--(1)
   (8)--1.0--(3)
   (1)--1.0--(11)
   (1)--1.0--(12)
   (2)--1.0--(13)
   (2)--1.0--(14)
   (4)--1.0--(15)
   (4)--1.0--(16)
   (5)--1.0--(17)
   (5)--1.0--(18)
   (6)--1.0--(19)
   (6)--1.0--(20)
   (7)--1.0--(21)
   (7)--1.0--(22)
   (8)--1.0--(23)
   (8)--1.0--(24)
   (9)--1.0--(25)
   (10)--1.0--(26)

</pre></div></div>
</div>
<p>The Molecule class has an extensive functionally to carry out molecular manipulations, for a comprenhesive disccusion about it have a look at the <a class="reference external" href="https://www.scm.com/doc/plams/molecule.html">molecule documentation</a>. Also the module <code class="docutils literal notranslate"><span class="pre">qmflows.molkit</span></code> contains an extensive functionality to apply transformation over a molecule using the <a class="reference external" href="http://www.rdkit.org/">RDKit</a> library.</p>
</div>
<div class="section" id="Runinng-a-quantum-mechanics-simulation">
<h2>Runinng a quantum mechanics simulation<a class="headerlink" href="#Runinng-a-quantum-mechanics-simulation" title="Permalink to this headline">¶</a></h2>
<p>We now have our components to perform a calculation: <strong>Settings</strong> and <strong>Molecule</strong>. We can now invoke a quantum chemistry package to perform the computation,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>the previous code snippet <em>does not execute the code immediatly</em>, instead the simulation is started when the user invokes the run function, as shown below</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plams</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">qmflows</span> <span class="kn">import</span> <span class="p">(</span><span class="n">adf</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">Settings</span><span class="p">,</span> <span class="n">templates</span><span class="p">)</span>

<span class="c1"># Settings</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">templates</span><span class="o">.</span><span class="n">geometry</span>
<span class="n">s</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;DZP&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">adf</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="s2">&quot;Large&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">freeze</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># molecule</span>
<span class="kn">from</span> <span class="nn">plams</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="n">acetonitrile</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;acetonitrile.xyz&quot;</span><span class="p">)</span>

<span class="c1"># Job</span>
<span class="n">optimized_mol_adf</span> <span class="o">=</span> <span class="n">adf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">acetonitrile</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;acetonitrile_opt&#39;</span><span class="p">)</span>

<span class="c1"># run the  job</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">optimized_mol_adf</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;acetonitrile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>you can run the previous script by saving it in a file called <code class="docutils literal notranslate"><span class="pre">acetonitrile_opt.py</span></code> and typing the following command in your console:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ python acetonitrile_opt.py
</pre></div>
</div>
<p>you will then see in your <em>current work directory</em> something similar to the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ ls
acetonitrile      acetonitrile_opt.py   cache.json   acetonitrile.xyz
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">acetonitrile</span></code> is the folder containing the output from the quantum package call (<code class="docutils literal notranslate"><span class="pre">ADF</span></code> in this case). The <code class="docutils literal notranslate"><span class="pre">cache.json</span></code> file contains all the information required to perform a restart, as we will explore below. Inside the <code class="docutils literal notranslate"><span class="pre">acetonitrile</span></code> you can find the input/output files resulting from the simulation</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ ls acetonitrile
acetonitrile.log  acetonitrile_opt

<span class="o">(</span>qmflows<span class="o">)[</span>user@int1 ~<span class="o">]</span>$ ls acetonitrile/acetonitrile_opt
 acetonitrile_opt.dill  acetonitrile_opt.out  logfile  t21.N
 acetonitrile_opt.err   acetonitrile_opt.run  t21.C
 acetonitrile_opt.in    acetonitrile_opt.t21  t21.H
</pre></div>
</div>
</div>
<div class="section" id="Extracting-Properties">
<h2>Extracting Properties<a class="headerlink" href="#Extracting-Properties" title="Permalink to this headline">¶</a></h2>
<p>In general, properties are extracted using the standard <code class="docutils literal notranslate"><span class="pre">Object.attribute</span></code> notation in python, as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">optmized_mol_adf</span><span class="o">.</span><span class="n">molecule</span>
</pre></div>
</div>
<p>Some of the available properties are shown in the following table,</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="20%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>dipole</td>
<td>Double</td>
<td>Molecular dipole mopment</td>
</tr>
<tr class="row-odd"><td>energy</td>
<td>Double</td>
<td>Total energy</td>
</tr>
<tr class="row-even"><td>enthalpy</td>
<td>Double</td>
<td>Enthalpy</td>
</tr>
<tr class="row-odd"><td>gradient</td>
<td>Numpy array</td>
<td>First derivatives of the energy</td>
</tr>
<tr class="row-even"><td>hessian</td>
<td>Numpy array</td>
<td>Second derivative of the energy</td>
</tr>
<tr class="row-odd"><td>molecule</td>
<td>Molecule</td>
<td>Object representing a physical entity</td>
</tr>
<tr class="row-even"><td>runtime</td>
<td>Double</td>
<td>Time spent in the simulation</td>
</tr>
</tbody>
</table>
<p>On the background <em>QMflows</em> has a mechanism to read the properties from the output files and make them available inside Python.</p>
</div>
<div class="section" id="Communicating-different-packages">
<h2>Communicating different packages<a class="headerlink" href="#Communicating-different-packages" title="Permalink to this headline">¶</a></h2>
<p>We can use the previous optimized geometry for further calculations using for instance another package like <em>Orca</em> to run a frequencies calculation,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<p>The whole script is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qmflows</span> <span class="kn">import</span> <span class="p">(</span><span class="n">adf</span><span class="p">,</span> <span class="n">orca</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="n">Settings</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">plams</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="kn">import</span> <span class="nn">plams</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">templates</span><span class="o">.</span><span class="n">geometry</span>
    <span class="n">s</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;DZP&quot;</span>
    <span class="n">s</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">adf</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="s2">&quot;large&quot;</span>

    <span class="n">acetonitrile</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;files/acetonitrile.xyz&quot;</span><span class="p">)</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">adf</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">acetonitrile</span><span class="p">)</span>
    <span class="n">optmized_mol_adf</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">molecule</span>

    <span class="n">s2</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">orca</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;freq&quot;</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">orca</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto_sz&#39;</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">orca</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">functional</span> <span class="o">=</span> <span class="s1">&#39;lda&#39;</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">specific</span><span class="o">.</span><span class="n">orca</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;dft&#39;</span>

    <span class="n">job_freq</span> <span class="o">=</span> <span class="n">orca</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">optmized_mol_adf</span><span class="p">)</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">job_freq</span><span class="o">.</span><span class="n">frequencies</span>

    <span class="k">print</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">frequencies</span><span class="p">))</span>
</pre></div>
</div>
<p>Once you run the script an input file for the <em>ADF</em> and <em>Orca</em> jobs are created. The <em>ADF</em> input looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Atoms</span>
      <span class="mi">1</span>         <span class="n">C</span>      <span class="mf">2.419290</span>      <span class="mf">0.606560</span>      <span class="mf">0.000000</span>
      <span class="mi">2</span>         <span class="n">C</span>      <span class="mf">1.671470</span>      <span class="mf">1.829570</span>      <span class="mf">0.000000</span>
      <span class="mi">3</span>         <span class="n">N</span>      <span class="mf">1.065290</span>      <span class="mf">2.809960</span>      <span class="mf">0.000000</span>
      <span class="mi">4</span>         <span class="n">H</span>      <span class="mf">2.000000</span>      <span class="mf">0.000000</span>      <span class="mf">1.000000</span>
      <span class="mi">5</span>         <span class="n">H</span>      <span class="mf">2.000000</span>      <span class="mf">0.000000</span>     <span class="o">-</span><span class="mf">1.000000</span>
      <span class="mi">6</span>         <span class="n">H</span>      <span class="mf">3.600000</span>      <span class="mf">0.800000</span>      <span class="mf">0.000000</span>
<span class="n">End</span>

<span class="n">Basis</span>
  <span class="n">Type</span> <span class="n">DZP</span>
<span class="n">End</span>

<span class="n">Constraints</span>
  <span class="n">Atom</span> <span class="mi">1</span>
  <span class="n">Atom</span> <span class="mi">2</span>
  <span class="n">Atom</span> <span class="mi">3</span>
<span class="n">End</span>

<span class="n">Geometry</span>
  <span class="n">Optim</span> <span class="n">cartesian</span>
<span class="n">End</span>

<span class="n">Integration</span>
  <span class="n">Accint</span> <span class="mf">6.0</span>
<span class="n">End</span>

<span class="n">Scf</span>
  <span class="n">Converge</span> <span class="mf">1e-06</span>
  <span class="n">Iterations</span> <span class="mi">100</span>
<span class="n">End</span>
</pre></div>
</div>
</div>
<div class="section" id="Running-in-a-supercomputer">
<h2>Running in a supercomputer<a class="headerlink" href="#Running-in-a-supercomputer" title="Permalink to this headline">¶</a></h2>
<p>Running in <strong>Cartesius</strong> or <strong>Bazis</strong> through the <em>Slurm</em> resource manager can be done using and script like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH -t 00:10:00</span>
<span class="c1">#SBATCH -N 1</span>
<span class="c1">#SBATCH -n 8</span>

module load orca
module load adf/2016.102

<span class="nb">source</span> activate qmflows
python optimization_ADF_freq_ORCA.py
</pre></div>
</div>
<p>The Slurm output looks like:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="How-the-run-function-works?">
<h2>How the run function works?<a class="headerlink" href="#How-the-run-function-works?" title="Permalink to this headline">¶</a></h2>
<div class="section" id="A-little-discussion-about-graphs">
<h3>A little discussion about graphs<a class="headerlink" href="#A-little-discussion-about-graphs" title="Permalink to this headline">¶</a></h3>
<p><em>qmflows</em> is meant to be used for both workflow generation and execution. When you write a python script representing a workflow you are explicitly declaring set of computations and their dependencies. For instance the following workflow represent <em>ADF</em> and <em>Orca</em> computations of the aforementioned example. In this <a class="reference external" href="https://en.wikipedia.org/wiki/Graph_theory">graph</a> the octagons represent quantum simulation using a package, while the ovals represent both user input or data extracted from a
simulation. Finally, the arrows (called edges) represent the dependencies between all these objects.</p>
<p><strong>QMflows</strong> automatically identify the dependencies between computations and run them in the correct order (if possible in parallel).</p>
</div>
<div class="section" id="Restarting-a-simulation">
<h3>Restarting a simulation<a class="headerlink" href="#Restarting-a-simulation" title="Permalink to this headline">¶</a></h3>
<p>If you are running many computationally expensive calculations in a supercomputer, it can happen that the computations take more time than that allowed by the resource manager in your supercomputer and the workflows gets cancel. But do not worry, you do not need to re-run all the computations. Fortunately, <em>QMflows</em> offers a mechanism to restart the workflow computations.</p>
<p>When running a workflow you will see that <em>QMflows</em> creates a set of files called <code class="docutils literal notranslate"><span class="pre">cache</span></code>. These files contain the information about the workflow and its calculation. <strong>In order to restart a workflow you only need to relaunch it</strong>, that’s it!</p>
</div>
</div>
<div class="section" id="Advanced-Examples">
<h2>Advanced Examples<a class="headerlink" href="#Advanced-Examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Conditional-Workflows">
<h3>Conditional Workflows<a class="headerlink" href="#Conditional-Workflows" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">noodles</span> <span class="kn">import</span> <span class="n">gather</span>
<span class="kn">from</span> <span class="nn">qmflows</span> <span class="kn">import</span> <span class="n">dftb</span><span class="p">,</span> <span class="n">adf</span><span class="p">,</span> <span class="n">orca</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">Settings</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="n">molkit</span><span class="p">,</span> <span class="n">find_first_job</span>

<span class="c1"># This examples illustrates the possibility to use different packages interchangeably.</span>
<span class="c1"># Analytical frequencies are not available for B3LYP in ADF</span>
<span class="c1"># This workflow captures the resulting error and submits the same job to ORCA.</span>

<span class="c1"># Define the condition for a successful calculation</span>
<span class="k">def</span> <span class="nf">is_successful</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;crashed&quot;</span><span class="p">]</span>

<span class="c1"># Generate water molecule</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">molkit</span><span class="o">.</span><span class="n">from_smiles</span><span class="p">(</span><span class="s1">&#39;[OH2]&#39;</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="s1">&#39;mmff&#39;</span><span class="p">)</span>

<span class="c1"># Pre-optimize the water molecule</span>
<span class="n">opt_water</span> <span class="o">=</span> <span class="n">dftb</span><span class="p">(</span>
     <span class="n">templates</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;dftb_geometry&quot;</span><span class="p">)</span>

<span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Generate freq jobs for 3 functionals</span>
<span class="k">for</span> <span class="n">functional</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pbe&#39;</span><span class="p">,</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;blyp&#39;</span><span class="p">]:</span>
    <span class="n">s</span><span class="o">=</span><span class="n">Settings</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;DZ&#39;</span>
    <span class="n">s</span><span class="o">.</span><span class="n">functional</span> <span class="o">=</span> <span class="n">functional</span>
    <span class="c1"># Try to perform the jobs with adf or orca</span>
    <span class="c1"># take result from  first successful calculation</span>
    <span class="n">freqjob</span> <span class="o">=</span> <span class="n">find_first_job</span><span class="p">(</span>
          <span class="n">is_successful</span><span class="p">,</span> <span class="p">[</span><span class="n">adf</span><span class="p">,</span> <span class="n">orca</span><span class="p">],</span> <span class="n">templates</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
          <span class="n">opt_water</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="n">functional</span><span class="p">)</span>
    <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqjob</span><span class="p">)</span>

<span class="c1"># Run workflow</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">jobs</span><span class="p">),</span> <span class="n">n_processes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>After running the above script you have a table like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pbe</span>     <span class="mf">1533.267</span>   <span class="mf">3676.165</span>   <span class="mf">3817.097</span>
<span class="n">b3lyp</span>   <span class="mf">1515.799</span>   <span class="mf">3670.390</span>   <span class="mf">3825.813</span>
<span class="n">blyp</span>    <span class="mf">1529.691</span>   <span class="mf">3655.573</span>   <span class="mf">3794.110</span>
</pre></div>
</div>
</div>
<div class="section" id="Non-adiabatic-couplings">
<h3>Non-adiabatic couplings<a class="headerlink" href="#Non-adiabatic-couplings" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/SCM-NV/qmflows-namd">qmflows-namd</a> is a package based on <strong>QMflows</strong> to compute the Non-adiabatic couplings for large system involving thr use of <strong>QMflows</strong>, <a class="reference external" href="http://cython.org/">Cython</a> and <a class="reference external" href="http://www.numpy.org/">Numpy</a>.</p>
</div>
</div>
<div class="section" id="Exception-Handling">
<h2>Exception Handling<a class="headerlink" href="#Exception-Handling" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have a set of non-dependent calculations, for example single point calculations coming from a molecular dynamic trajectory, as shown in the figure below</p>
<p>If one of the single point calculations fails, the rest of the point in the workflow will keep on running and the failed job will return a <strong>None</strong> value for the requested property.</p>
<p>If the single point calculation would be the dependency of another quantum calculation then the computation will crash.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="documentation.html" class="btn btn-neutral float-right" title="Library Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="interactive_tutorial.html" class="btn btn-neutral" title="Basic usage tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, F. Zapata, L. Ridder, B. F. van Beek

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>