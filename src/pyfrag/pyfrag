#!/bin/bash

# ==================================================================
# This script is a wrapper around the "main.py" script.
#
# Its purpose is to check if there is a virtual environment set up
# which is recommended if PyFrag is installed on a computer cluster as a module
# ==================================================================

function activate_venv() {
    local venv_folder="${1:-venv}"
    source "${venv_folder}/bin/activate"
}

echo "Starting PyFrag..."

# Get the root directory of PyFrag package
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PYFRAGROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"


# 1. Try to find and activate a virtual environment if it exists
VENV_PATH="$PYFRAGROOT/.venv"
if [[ -d "$VENV_PATH" ]]; then
    echo "Activating virtual environment at $VENV_PATH"
    source "$VENV_PATH/bin/activate"
else
    echo "No virtual environment found at $VENV_PATH. Continuing with the current Python environment."
fi

# 2. Check if python is available
if ! command -v python &> /dev/null; then
    echo "Critical: Python is not available in your environment. Please load a Python module or install Python."
    exit 1
fi

# 3. Check if pyfrag is importable
python -c "import pyfrag" 2>/dev/null
if [[ $? -ne 0 ]]; then
    echo "Critical: The 'pyfrag' package is not importable in this Python environment."
    echo "Please ensure you have installed pyfrag (e.g., pip install . or pip install pyfrag) in your current Python environment."
    exit 1
fi

echo "Starting PyFrag..."
python -m pyfrag.main "$@"
